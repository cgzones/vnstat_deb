From: =?utf-8?q?Christian_G=C3=B6ttsche?= <cgzones@googlemail.com>
Date: Tue, 5 Sep 2017 11:44:30 +0200
Subject: check number of items read by fread()

Also check the filestream with ferror()

Found by coverity
---
 src/dbaccess.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/dbaccess.c b/src/dbaccess.c
index ffab312..a0ef269 100644
--- a/src/dbaccess.c
+++ b/src/dbaccess.c
@@ -27,7 +27,7 @@ int readdb(const char *iface, const char *dirname, const int force)
 		return -1;
 	}
 
-	if (fread(&data,sizeof(DATA),1,db)==0) {
+	if (fread(&data,sizeof(DATA),1,db)!=1 || ferror(db)) {
 		data.version=-1;
 		if (debug) {
 			printf("db: Database read failed for file \"%s\".\n", file);
@@ -76,7 +76,7 @@ int readdb(const char *iface, const char *dirname, const int force)
 				return -1;
 			}
 
-			if (fread(&data,sizeof(DATA),1,db)==0) {
+			if (fread(&data,sizeof(DATA),1,db)!=1 || ferror(db)) {
 				snprintf(errorstring, 512, "Database load failed even when using backup (%s). Aborting.", strerror(errno));
 				printe(PT_Error);
 				fclose(db);
